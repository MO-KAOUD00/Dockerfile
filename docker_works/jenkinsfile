 pipeline {
     agent any
     environment{
        DOCKERHUB_CREDENTIALS = credentials('dockerhub-credentials')
        IMAGE_NAME = "mohamed206/docker-jenkins"
     }
     stages {

         stage('build docker image') {

             steps {
                 script {
                     sh 'docker build -t ${IMAGE_NAME}:${JOB_NAME}_${BUILD_NUMBER} -f docker_works/Dockerfile docker_works'
                 }
             }
         }

         stage('login and push to docker_hub') {
             steps {
                 script {
                      withCredentials([usernamePassword(credentialsId: env.DOCKERHUB_CREDENTIALS, usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                        sh """
                        echo "${PASSWORD}" | docker login -u "${USERNAME}" --password-stdin
                        docker push ${IMAGE_NAME}:${BUILD_NUMBER}
                        """
                     }
                 }
             }
         }
         stage('deploy') {
             steps {
                 script {
                     echo "Deploying application"
                 }
             }
         }
     }
 }
